          <div class="header-select">
            <% if @modelo_aplicado.any? %>
              <%= select_tag "modelo_aplicado_id", 
                options_for_select(
                  @modelo_aplicado.map do |modelo_aplicado|
                    [
                      "#{@maturidades.find(modelo_aplicado.maturidade_id).nome} - #{modelo_aplicado.dominio}",
                      modelo_aplicado.id,
                      { class: "#{modelo_aplicado.maturidade_id}" }
                    ]
                  end,
                  @modelo
                ),
                prompt: "Escolha um modelo para avaliar",
                class: "modelo corpo_texto_select"
              %>
            <% else %>
              <%= select_tag "modelo_aplicado_id",
                options_for_select([]),
                prompt: "Nenhum modelo dispon√≠vel para suas √°reas de atua√ß√£o",
                disabled: true,
                class: "modelo corpo_texto_select"
              %>
            <% end %>
          </div>
        </div>
        <button onclick="showModalInfos()" class="header-title-info d-flex-center-center h-100">
          <%= image_tag('icons/info.svg', width: '25px', height: '25px') %>
        </button>
      </div>
      <!--
      <div class="header-links d-flex-center-start h-100 w-fit">
        <div class="header-links-wrapper d-flex-center-center">
          <div onclick="mostraOpcoesPrimariasModelo()" class="header-link d-flex-center-start h-fit">
            <%= image_tag('icons/edit2.svg', width: '20px', height: '20px') %>
            <a href="#">Editar op√ß√µes do Modelo</a>
          </div>
        </div>
      </div> 
      -->
      <div style="display: none">
        <%if @opcao != 0%>
            <% maturidade_selecionada = Maturidade.find(@opcao)%>
            <div id="mudancaResultado" class="<%=maturidade_selecionada.resultadoEscolha%>"> </div>
            <div id="maturidadeSelecionadaNivelEscolha" class="<%= maturidade_selecionada.nivelEscolha%>"></div>
        <%end%>
      </div>
    </header>

    <section class="main-content main-utlizar-modelo">
      
      <!--S== Dimens√£o -->
      <% contadorDimensaos = 1 %>
      <% @dimensaos.each do |dimensao| %>
        <%if dimensao.maturidade_id == @opcao%>
          <div id="dimencao-<%= dimensao.id %>" class="dimencao">
            <!--A== Header-Dimens√£o -->
            <div id="header-dimencao-<%= dimensao.id %>" class="expandable-header d-flex-center-between dimencao w-100 align-top">
              <div class="expandable-header-left d-flex-center-start" onclick="toggleDimensao(<%= dimensao.id %>)"><!-- o 1 do id √© o id da dimens√£o-->
                <div onclick="expandeMain('dimencao-<%= dimensao.id %>')">
                  <i id="plus-dimencao-<%= dimensao.id %>" class="fa-solid fa-plus"></i>
                  <i id="minus-dimencao-<%= dimensao.id %>" class="fa-solid fa-minus hidden"></i>
                </div>
                <h3 id="titulo-nivel-<%= dimensao.id %>" onclick="mostra_titulo('<%= dimensao.id %>')"> <strong><%= contadorDimensaos %>- </strong><%= dimensao.descricao %></h3>
              </div>
            </div>
          
            <!--A== Main-Dimens√£o-1 -->
            <div id="main-dimencao-<%= dimensao.id %>" class="expandable-main dimencao hidden">    
              <% contadorProcessos = 1 %>
              <% @processos.each do |processo| %>
                <%if dimensao.id == processo.dimensao_id%>    
                  <!--S== Processo-1-1 -->
                  <div id="processo-<%= dimensao.id %>-<%= processo.id %>" class="processo">
                    <!--A== Header-Processo-1-1 -->
                    <div id="header-processo-<%= dimensao.id %>-<%= processo.id %>" class="expandable-header d-flex-center-between processo w-100 align-top">
                      <div class="expandable-header-left d-flex-center-start" onclick="toggleProcesso(<%= processo.id %>)"><!-- o 1 do id √© o id da dimens√£o-->
                        <div onclick="expandeMain('processo-<%= dimensao.id %>-<%= processo.id %>')">
                          <i id="plus-processo-<%= dimensao.id %>-<%= processo.id %>" class="fa-solid fa-plus abrir_form_resultado_esperado"></i>
                          <i id="minus-processo-<%= dimensao.id %>-<%= processo.id %>" class="fa-solid fa-minus hidden"></i>
                        </div>
                        <h3 id="titulo-nivel-<%= dimensao.id %>-<%= processo.id %>" onclick="mostra_titulo('<%= dimensao.id %>-<%= processo.id %>')"><strong><%= contadorDimensaos %>.<%= contadorProcessos %> - </strong><%= processo.descricao %></h3>
                        <% if processo.nivel_selecionado %>
                          <%if maturidade_selecionada.tipoNivel == "1"%>
                            <%salvarDescricao = ""%>
                            <%contadorExistencia = 0%>
                            <% @levels.each do |level| %>
                              <% if processo.nivel_selecionado.to_i == level.index.to_i && level.modelo_id.to_i == @opcao %>
                                <%salvarDescricao = level.descricao%>
                                <%contadorExistencia = 1%>
                              <%end%>
                            <% end %>
                          <%else%>
                            <%salvarDescricao = ""%>
                            <%contadorExistencia = 0%>
                            <% @levels.each do |level| %>
                              <% if processo.nivel_selecionado.to_s == level.index.to_s && level.modelo_id.to_i == @opcao %>
                                <%salvarDescricao = level.descricao%>
                                <%contadorExistencia = 1%>
                              <%end%>
                            <% end %>
                          <%end%>
                        <div class="select-nivel-maturidade processoNivelSelecionado hidden" name="nome" id="" disabled>
                          <p><%= processo.nivel_selecionado %>
                          <% if contadorExistencia == 1%>
                            - <%= salvarDescricao %>
                          <% end %>
                          </p>
                        </div>
                          <%salvarDescricao = ""%>
                          <%contadorExistencia = 0%>
                      <% end %>
                      </div>
                    </div>  
            
                    <!--A== Main-Processo-1-1 -->
                    <div id="main-processo-<%= dimensao.id %>-<%= processo.id %>" class="expandable-main processo hidden">
                      <%if @opcao != 0%>
                        <%if maturidade_selecionada.nivelEscolha == "1" || (maturidade_selecionada.nivelEscolha == "3" && maturidade_selecionada.resultadoEscolha == "1")%> <!--x ESTAMOS AQUI
                          <div class="file-galery-wrapper dimencao">
                            <ul class="file-galery m-0"  style="border: 0px;">
                            <% if processo.docs.attached? %>
                              <% processo.docs.each do |doc| %>
                                <%if doc.blob.modelo == @modelo%>
                                  <!-- Arquivo-1-Dimens√£o-1 -->
                                  <li id="doc-<%= dimensao.id %>-<%= processo.id %>--<%= doc.id %>" class="file-galery-item d-flex-center-between m-0" style="border: 0px 0px 1px 0px; padding: 10px;">
                                    <div class="d-flex-center-start">  
                                      <h5 class="descricao-artefato"><%= doc.descricao %></h5>
                                      <span class="descricao-artefato">-</span>
                                      <%= link_to doc.filename, rails_blob_path(doc, disposition: 'attachment'), class: 'download-link' %>
                                    </div>
                                    <!-- Adicionar antes do formul√°rio de avalia√ß√£o existente -->
                                    <div class="ai-evaluation-controls" style="margin-bottom: 15px;">
                                      <button onclick="avaliarComIA(<%= doc.id %>)" class="btn-ai-evaluate" title="Avaliar com IA">
                                        ü§ñ Avaliar com IA
                                      </button>
                                      
                                      <% if current_appraiser.expertise_areas.any? %>
                                        <button onclick="avaliarLoteComIA(<%= @modelo %>)" class="btn-ai-batch" title="Avaliar todos os documentos n√£o avaliados com IA">
                                          üöÄ Avaliar Lote com IA
                                        </button>
                                      <% end %>
                                    </div>

                                    <!-- Modificar o formul√°rio existente para incluir indicadores de IA -->
                                    <form action="/avaliar/<%= doc.id %>/salvar_classificacao_docs" method="post">
                                        <select name="classificacao" onchange="this.form.submit()" <%= doc.blob.ai_generated? ? 'style="border: 2px solid #4CAF50;"' : '' %>>
                                            <option value="" disabled selected>Selecione uma op√ß√£o</option>
                                            <option value="1" <%= doc.blob.classificacao == 1 ? 'selected' : '' %>>Atende Totalmente</option>
                                            <option value="2" <%= doc.blob.classificacao == 2 ? 'selected' : '' %>>Atende Parcialmente</option>
                                            <option value="3" <%= doc.blob.classificacao == 3 ? 'selected' : '' %>>N√£o Atende</option>
                                        </select>
                                        
                                        <% if doc.blob.ai_generated? %>
                                            <div class="ai-indicator" title="Avaliado por IA">
                                                ü§ñ <small>Sugest√£o de IA</small>
                                            </div>
                                        <% end %>
                                        
                                        <textarea name="descricao_avaliador" 
                                                  placeholder="Justifique sua escolha" 
                                                  rows="2" 
                                                  style="width:400px;margin-top:5px;resize:none;min-height:40px;overflow-y:hidden;<%= doc.blob.ai_generated? ? 'border: 2px solid #4CAF50;' : '' %>" 
                                                  onchange="this.form.submit()" 
                                                  oninput="autoResize(this)"><%= doc.blob.descricao_avaliador %></textarea>
                                                  
                                        <% if doc.blob.ai_generated? && !doc.blob.reviewed_by_appraiser? %>
                                            <div class="ai-review-controls">
                                                <button type="button" onclick="marcarComoRevisado(<%= doc.id %>)" class="btn-confirm-ai">
                                                    ‚úì Confirmar Avalia√ß√£o da IA
                                                </button>
                                            </div>
                                        <% end %>
                                    </form>

                                    <!-- Adicionar JavaScript para funcionalidades de IA -->
                                    <script>
                                    function avaliarComIA(docId) {
                                        // Mostrar loading
                                        showLoading("Avaliando documento com IA...");
                                        
                                        fetch(`/avaliar/${docId}/avaliar_com_ia`, {
                                            method: 'POST',
                                            headers: {
                                                'Content-Type': 'application/json',
                                                'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
                                            }
                                        })
                                        .then(response => response.json())
                                        .then(data => {
                                            hideLoading();
                                            
                                            if (data.success) {
                                                // Atualizar a interface com a sugest√£o da IA
                                                showNotification(`Avalia√ß√£o conclu√≠da: ${getClassificationText(data.classification)}`, 'success');
                                                location.reload(); // Recarregar para mostrar as mudan√ßas
                                            } else {
                                                showNotification(`Erro na avalia√ß√£o: ${data.error}`, 'error');
                                            }
                                        })
                                        .catch(error => {
                                            hideLoading();
                                            showNotification('Erro na comunica√ß√£o com o servidor', 'error');
                                        });
                                    }

                                    function avaliarLoteComIA(modeloId) {
                                        if (!confirm('Avaliar todos os documentos n√£o avaliados com IA? Esta opera√ß√£o pode demorar alguns minutos.')) {
                                            return;
                                        }
                                        
                                        showLoading("Avaliando documentos em lote com IA...");
                                        
                                        fetch('/avaliar/avaliar_lote_com_ia', {
                                            method: 'POST',
                                            headers: {
                                                'Content-Type': 'application/json',
                                                'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
                                            },
                                            body: JSON.stringify({ modelo_id: modeloId })
                                        })
                                        .then(response => response.json())
                                        .then(data => {
                                            hideLoading();
                                            showNotification(data.message, 'success');
                                            location.reload();
                                        })
                                        .catch(error => {
                                            hideLoading();
                                            showNotification('Erro na avalia√ß√£o em lote', 'error');
                                        });
                                    }

                                    function marcarComoRevisado(docId) {
                                        fetch(`/avaliar/${docId}/marcar_revisado`, {
                                            method: 'POST',
                                            headers: {
                                                'Content-Type': 'application/json',
                                                'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
                                            }
                                        })
                                        .then(response => response.json())
                                        .then(data => {
                                            if (data.success) {
                                                showNotification('Avalia√ß√£o confirmada', 'success');
                                                location.reload();
                                            }
                                        });
                                    }

                                    function getClassificationText(classification) {
                                        switch(classification) {
                                            case 1: return 'Atende Totalmente';
                                            case 2: return 'Atende Parcialmente';
                                            case 3: return 'N√£o Atende';
                                            default: return 'N√£o classificado';
                                        }
                                    }

                                    function showLoading(message) {
                                        // Implementar overlay de loading
                                        const loading = document.createElement('div');
                                        loading.id = 'ai-loading';
                                        loading.innerHTML = `
                                            <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; display: flex; align-items: center; justify-content: center;">
                                                <div style="background: white; padding: 20px; border-radius: 10px; text-align: center;">
                                                    <div class="spinner"></div>
                                                    <p>${message}</p>
                                                </div>
                                            </div>
                                        `;
                                        document.body.appendChild(loading);
                                    }

                                    function hideLoading() {
                                        const loading = document.getElementById('ai-loading');
                                        if (loading) {
                                            loading.remove();
                                        }
                                    }

                                    function showNotification(message, type) {
                                        // Implementar sistema de notifica√ß√µes
                                        const notification = document.createElement('div');
                                        notification.className = `notification ${type}`;
                                        notification.textContent = message;
                                        notification.style.cssText = `
                                            position: fixed;
                                            top: 20px;
                                            right: 20px;
                                            padding: 15px;
                                            border-radius: 5px;
                                            color: white;
                                            z-index: 10000;
                                            ${type === 'success' ? 'background: #4CAF50;' : 'background: #f44336;'}
                                        `;
                                        
                                        document.body.appendChild(notification);
                                        
                                        setTimeout(() => {
                                            notification.remove();
                                        }, 5000);
                                    }
                                    </script>

                                    <style>
                                    .ai-evaluation-controls {
                                        display: flex;
                                        gap: 10px;
                                        margin-bottom: 15px;
                                    }

                                    .btn-ai-evaluate, .btn-ai-batch {
                                        background: #4CAF50;
                                        color: white;
                                        border: none;
                                        padding: 8px 15px;
                                        border-radius: 5px;
                                        cursor: pointer;
                                        font-size: 12px;
                                    }

                                    .btn-ai-evaluate:hover, .btn-ai-batch:hover {
                                        background: #45a049;
                                    }

                                    .ai-indicator {
                                        background: #e8f5e8;
                                        color: #2e7d32;
                                        padding: 5px;
                                        border-radius: 3px;
                                        font-size: 11px;
                                        margin-top: 5px;
                                    }

                                    .btn-confirm-ai {
                                        background: #2196F3;
                                        color: white;
                                        border: none;
                                        padding: 5px 10px;
                                        border-radius: 3px;
                                        font-size: 11px;
                                        margin-top: 5px;
                                        cursor: pointer;
                                    }

                                    .spinner {
                                        border: 4px solid #f3f3f3;
                                        border-top: 4px solid #3498db;
                                        border-radius: 50%;
                                        width: 30px;
                                        height: 30px;
                                        animation: spin 1s linear infinite;
                                        margin: 0 auto 10px;
                                    }

                                    @keyframes spin {
                                        0% { transform: rotate(0deg); }
                                        100% { transform: rotate(360deg); }
                                    }
                                    </style>
                                  </li>
                                <% end %> 
                              <% end %> 
                            <% end %>
                            </ul>
                          </div>
                        <% end %>
                      <% end %>

                      <%if maturidade_selecionada.resultadoEscolha == "2"%>
                        <% contadorResultados = 1 %>
                        <% @resultados.each do |resultado| %>
                          <%if processo.id == resultado.processo_id%>        
                            <!--S== Resultado -->
                            <div id="resultado-<%= dimensao.id %>-<%= processo.id %>-<%= resultado.id %>" class="resultado">
                              <!--A== Header-Resultado -->
                              <div id="header-resultado-<%= dimensao.id %>-<%= processo.id %>-<%= resultado.id %>" class="expandable-header d-flex-center-between resultado w-100 align-top">
                                <div class="expandable-header-left d-flex-center-start" onclick="toggleResultado(<%= dimensao.id %>, <%= processo.id %>, <%= resultado.id %>)"><!-- o 1 do id √© o id da dimens√£o-->
                                  <div onclick="expandeMain('resultado-<%= dimensao.id %>-<%= processo.id %>-<%= resultado.id %>')">
                                    <i id="plus-resultado-<%= dimensao.id %>-<%= processo.id %>-<%= resultado.id %>" class="fa-solid fa-plus"></i>
                                    <i id="minus-resultado-<%= dimensao.id %>-<%= processo.id %>-<%= resultado.id %>" class="fa-solid fa-minus hidden"></i>
                                  </div>
                                  <h3 id="titulo-nivel-<%= dimensao.id %>-<%= processo.id %>-<%= resultado.id %>" onclick="mostra_titulo('<%= dimensao.id %>-<%= processo.id %>-<%= resultado.id %>')"><strong><%= contadorDimensaos %>.<%= contadorProcessos %>.<%= contadorResultados %> - </strong><%= resultado.descricao %></h3>
                                  <%if maturidade_selecionada.tipoNivel == "1"%>
                                    <%salvarDescricao = ""%>
                                    <%contadorExistencia = 0%>
                                    <% @levels.each do |level| %>
                                      <% if resultado.nivel_selecionado.to_i == level.index.to_i && level.modelo_id.to_i == @opcao %>
                                        <%salvarDescricao = level.descricao%>
                                        <%contadorExistencia = 1%>
                                      <%end%>
                                    <% end %>
                                  <%else%>
                                    <%salvarDescricao = ""%>
                                    <%contadorExistencia = 0%>
                                    <% @levels.each do |level| %>
                                      <% if resultado.nivel_selecionado.to_s == level.index.to_s && level.modelo_id.to_i == @opcao %>
                                        <%salvarDescricao = level.descricao%>
                                        <%contadorExistencia = 1%>
                                      <%end%>
                                    <% end %>
                                  <%end%>
                                  <div class="select-nivel-maturidade resultadoNivelSelecionado hidden" name="nome" id="" disabled>
                                    <p><%= resultado.nivel_selecionado %>
                                    <% if contadorExistencia == 1%> 
                                      - <%= salvarDescricao %>
                                    <% end %>
                                    </p>
                                  </div>
                                  <%salvarDescricao = ""%>
                                  <%contadorExistencia = 0%>
                                </div>
                              </div>
                              <!--A== Main-Resultado -->
                              <div id="main-resultado-<%= dimensao.id %>-<%= processo.id %>-<%= resultado.id %>" class="expandable-main resultado hidden">
                                <%if maturidade_selecionada.nivelEscolha == "2" || (maturidade_selecionada.nivelEscolha == "3" && maturidade_selecionada.resultadoEscolha == "2")%>
                                  <div class="file-galery-wrapper dimencao">
                                    <ul class="file-galery m-0" style="border: 0px;">
                                      <% if resultado.docs.attached? %>
                                        <% resultado.docs.each do |doc| %>
                                          <%if doc.blob.modelo == @modelo%>
                                            <!-- Arquivo-1-Dimens√£o-1 -->
                                            <li id="doc-<%= dimensao.id %>-<%= resultado.id %>--<%= doc.id %>" class="file-galery-item d-flex-center-between m-0" style="border: 0px 0px 1px 0px; padding: 10px;">
                                              <div class="d-flex-center-start">  
                                                <h5 class="descricao-artefato"><%= doc.descricao %></h5>
                                                <span class="descricao-artefato">-</span>
                                                <%= link_to doc.filename, rails_blob_path(doc, disposition: 'attachment'), class: 'download-link' %>
                                              </div>
                                              <!-- Adicionar antes do formul√°rio de avalia√ß√£o existente -->
                                              <div class="ai-evaluation-controls" style="margin-bottom: 15px;">
                                                <button onclick="avaliarComIA(<%= doc.id %>)" class="btn-ai-evaluate" title="Avaliar com IA">
                                                  ü§ñ Avaliar com IA
                                                </button>
                                                
                                                <% if current_appraiser.expertise_areas.any? %>
                                                  <button onclick="avaliarLoteComIA(<%= @modelo %>)" class="btn-ai-batch" title="Avaliar todos os documentos n√£o avaliados com IA">
                                                    üöÄ Avaliar Lote com IA
                                                  </button>
                                                <% end %>
                                              </div>

                                              <!-- Modificar o formul√°rio existente para incluir indicadores de IA -->
                                              <form action="/avaliar/<%= doc.id %>/salvar_classificacao_docs" method="post">
                                                  <select name="classificacao" onchange="this.form.submit()" <%= doc.blob.ai_generated? ? 'style="border: 2px solid #4CAF50;"' : '' %>>
                                                      <option value="" disabled selected>Selecione uma op√ß√£o</option>
                                                      <option value="1" <%= doc.blob.classificacao == 1 ? 'selected' : '' %>>Atende Totalmente</option>
                                                      <option value="2" <%= doc.blob.classificacao == 2 ? 'selected' : '' %>>Atende Parcialmente</option>
                                                      <option value="3" <%= doc.blob.classificacao == 3 ? 'selected' : '' %>>N√£o Atende</option>
                                                  </select>
                                                  
                                                  <% if doc.blob.ai_generated? %>
                                                      <div class="ai-indicator" title="Avaliado por IA">
                                                          ü§ñ <small>Sugest√£o de IA</small>
                                                      </div>
                                                  <% end %>
                                                  
                                                  <textarea name="descricao_avaliador" 
                                                            placeholder="Justifique sua escolha" 
                                                            rows="2" 
                                                            style="width:400px;margin-top:5px;resize:none;min-height:40px;overflow-y:hidden;<%= doc.blob.ai_generated? ? 'border: 2px solid #4CAF50;' : '' %>" 
                                                            onchange="this.form.submit()" 
                                                            oninput="autoResize(this)"><%= doc.blob.descricao_avaliador %></textarea>
                                                            
                                                  <% if doc.blob.ai_generated? && !doc.blob.reviewed_by_appraiser? %>
                                                      <div class="ai-review-controls">
                                                          <button type="button" onclick="marcarComoRevisado(<%= doc.id %>)" class="btn-confirm-ai">
                                                              ‚úì Confirmar Avalia√ß√£o da IA
                                                          </button>
                                                      </div>
                                                  <% end %>
                                              </form>

                                              <!-- Adicionar JavaScript para funcionalidades de IA -->
                                              <script>
                                              function avaliarComIA(docId) {
                                                  // Mostrar loading
                                                  showLoading("Avaliando documento com IA...");
                                                  
                                                  fetch(`/avaliar/${docId}/avaliar_com_ia`, {
                                                      method: 'POST',
                                                      headers: {
                                                          'Content-Type': 'application/json',
                                                          'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
                                                      }
                                                  })
                                                  .then(response => response.json())
                                                  .then(data => {
                                                      hideLoading();
                                                      
                                                      if (data.success) {
                                                          // Atualizar a interface com a sugest√£o da IA
                                                          showNotification(`Avalia√ß√£o conclu√≠da: ${getClassificationText(data.classification)}`, 'success');
                                                          location.reload(); // Recarregar para mostrar as mudan√ßas
                                                      } else {
                                                          showNotification(`Erro na avalia√ß√£o: ${data.error}`, 'error');
                                                      }
                                                  })
                                                  .catch(error => {
                                                      hideLoading();
                                                      showNotification('Erro na comunica√ß√£o com o servidor', 'error');
                                                  });
                                              }

                                              function avaliarLoteComIA(modeloId) {
                                                  if (!confirm('Avaliar todos os documentos n√£o avaliados com IA? Esta opera√ß√£o pode demorar alguns minutos.')) {
                                                      return;
                                                  }
                                                  
                                                  showLoading("Avaliando documentos em lote com IA...");
                                                  
                                                  fetch('/avaliar/avaliar_lote_com_ia', {
                                                      method: 'POST',
                                                      headers: {
                                                          'Content-Type': 'application/json',
                                                          'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
                                                      },
                                                      body: JSON.stringify({ modelo_id: modeloId })
                                                  })
                                                  .then(response => response.json())
                                                  .then(data => {
                                                      hideLoading();
                                                      showNotification(data.message, 'success');
                                                      location.reload();
                                                  })
                                                  .catch(error => {
                                                      hideLoading();
                                                      showNotification('Erro na avalia√ß√£o em lote', 'error');
                                                  });
                                              }

                                              function marcarComoRevisado(docId) {
                                                  fetch(`/avaliar/${docId}/marcar_revisado`, {
                                                      method: 'POST',
                                                      headers: {
                                                          'Content-Type': 'application/json',
                                                          'X-CSRF-Token': document.querySelector('[name="csrf-token"]').content
                                                      }
                                                  })
                                                  .then(response => response.json())
                                                  .then(data => {
                                                      if (data.success) {
                                                          showNotification('Avalia√ß√£o confirmada', 'success');
                                                          location.reload();
                                                      }
                                                  });
                                              }

                                              function getClassificationText(classification) {
                                                  switch(classification) {
                                                      case 1: return 'Atende Totalmente';
                                                      case 2: return 'Atende Parcialmente';
                                                      case 3: return 'N√£o Atende';
                                                      default: return 'N√£o classificado';
                                                  }
                                              }

                                              function showLoading(message) {
                                                  // Implementar overlay de loading
                                                  const loading = document.createElement('div');
                                                  loading.id = 'ai-loading';
                                                  loading.innerHTML = `
                                                      <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; display: flex; align-items: center; justify-content: center;">
                                                          <div style="background: white; padding: 20px; border-radius: 10px; text-align: center;">
                                                              <div class="spinner"></div>
                                                              <p>${message}</p>
                                                          </div>
                                                      </div>
                                                  `;
                                                  document.body.appendChild(loading);
                                              }

                                              function hideLoading() {
                                                  const loading = document.getElementById('ai-loading');
                                                  if (loading) {
                                                      loading.remove();
                                                  }
                                              }

                                              function showNotification(message, type) {
                                                  // Implementar sistema de notifica√ß√µes
                                                  const notification = document.createElement('div');
                                                  notification.className = `notification ${type}`;
                                                  notification.textContent = message;
                                                  notification.style.cssText = `
                                                      position: fixed;
                                                      top: 20px;
                                                      right: 20px;
                                                      padding: 15px;
                                                      border-radius: 5px;
                                                      color: white;
                                                      z-index: 10000;
                                                      ${type === 'success' ? 'background: #4CAF50;' : 'background: #f44336;'}
                                                  `;
                                                  
                                                  document.body.appendChild(notification);
                                                  
                                                  setTimeout(() => {
                                                      notification.remove();
                                                  }, 5000);
                                              }
                                              </script>

                                              <style>
                                              .ai-evaluation-controls {
                                                  display: flex;
                                                  gap: 10px;
                                                  margin-bottom: 15px;
                                              }

                                              .btn-ai-evaluate, .btn-ai-batch {
                                                  background: #4CAF50;
                                                  color: white;
                                                  border: none;
                                                  padding: 8px 15px;
                                                  border-radius: 5px;
                                                  cursor: pointer;
                                                  font-size: 12px;
                                              }

                                              .btn-ai-evaluate:hover, .btn-ai-batch:hover {
                                                  background: #45a049;
                                              }

                                              .ai-indicator {
                                                  background: #e8f5e8;
                                                  color: #2e7d32;
                                                  padding: 5px;
                                                  border-radius: 3px;
                                                  font-size: 11px;
                                                  margin-top: 5px;
                                              }

                                              .btn-confirm-ai {
                                                  background: #2196F3;
                                                  color: white;
                                                  border: none;
                                                  padding: 5px 10px;
                                                  border-radius: 3px;
                                                  font-size: 11px;
                                                  margin-top: 5px;
                                                  cursor: pointer;
                                              }

                                              .spinner {
                                                  border: 4px solid #f3f3f3;
                                                  border-top: 4px solid #3498db;
                                                  border-radius: 50%;
                                                  width: 30px;
                                                  height: 30px;
                                                  animation: spin 1s linear infinite;
                                                  margin: 0 auto 10px;
                                              }

                                              @keyframes spin {
                                                  0% { transform: rotate(0deg); }
                                                  100% { transform: rotate(360deg); }
                                              }
                                              </style>
                                            </li>
                                          <% end %>
                                        <% end %> 
                                      <% end %>
                                    </ul>
                                  </div>
                                <% end %>
                              </div>
                            </div>
                            <!--!S== Resultado -->
                            <%contadorResultados = contadorResultados + 1%>
                          <%end%>
                        <%end%>
                      <%end%>
                    </div>
                  </div>
                  <%contadorProcessos = contadorProcessos + 1%>
                <% end %>  <!-- /I -->
              <% end %>  <!-- /J -->
            </div> 
          </div>
          <%contadorDimensaos = contadorDimensaos + 1%>
        <% end %> <!-- /L -->
      <% end %> <!-- /M -->
    </section>
  </main>

  <style>
    /* For√ßar que os blocos expans√≠veis da p√°gina Avaliar comecem escondidos */
    .main-content.main-utlizar-modelo .expandable-main { display: none !important; }
  </style>

<style>
  .expandable-header {
    align-items: flex-start !important;
  }
</style>


  <script>
    //contante de todos os ids de todos os popups da pagina;
    const listaPopups = ["cadastrar_dominio", "confirmar_exclusao"];

    //Fun√ß√£o para mostrar um popup qualquer
    function show_popup(id_popup, rota) {
      const popup = document.getElementById(id_popup);

      if(popup) {
        const popupBg = document.getElementById("popup_background");

        if(popup.classList.contains("hidden")) {
          popup.classList.remove("hidden");
          popupBg.classList.remove("hidden");
        } else {
          popup.classList.add("hidden");
          popupBg.classList.add("hidden");
        }

        if(popup == "confirmar_exclusao") {
          document.getElementById('btn_confirma_exclusao').setAttribute('onclick', `location.href='`+rota+`'`);
        }
      }
    }

    //Fun√ß√£o para fechar todos os popups abertos
    function closeAll_popup(event) {
      const popupBg = document.getElementById("popup_background");

      if(event.target === popupBg) {
        popupBg.classList.add("hidden");
        console.log(popupBg.classList);
        listaPopups.forEach(function(popupId) {
          let popup = document.getElementById(popupId);
          if(!popup.classList.contains("hidden")) {
            popup.classList.add("hidden");
          }
        });
      }
    }
  </script>

  <script>
    //* Retira o disabled do botao de exclus√£o do modal de confirma√ß√£o de exclus√£o
    function liberaBotaoExclusao() {
      let inputConfirmaExclusao = document.getElementById('input_confirmation_exclusao');
      let btnConfirmaExclusao = document.getElementById('btn_confirma_exclusao');

      if(inputConfirmaExclusao.value == 'confirmo')
        btnConfirmaExclusao.disabled = false;
      else
        btnConfirmaExclusao.disabled = true;
    }
    //* Fim ---
  </script>


    <!--# Fun√ß√£o de expandir e retrair as camadas dos modelos -->
  <script>
    function expandeMain(id_expandir) {
      var div_expandir = document.getElementById('main-' + id_expandir);
      var plus_trocar = document.getElementById('plus-' + id_expandir);
      var minus_trocar = document.getElementById('minus-' + id_expandir);

      if (div_expandir.classList.contains('hidden')) {
        div_expandir.classList.remove('hidden');
        plus_trocar.classList.add('hidden');
        minus_trocar.classList.remove('hidden');

      } else {
        div_expandir.classList.add('hidden');
        plus_trocar.classList.remove('hidden');
        minus_trocar.classList.add('hidden');
      }
    }

    //* Mostrar Modal de confirma√ß√£o de exclus√£o:
    function showModalConfirmacao() {
      let modalConfirmacao = document.getElementById('modal_confirmacao');
      let inputConfirmaExclusao = document.getElementById('input_confirmation_exclusao');
      let btnConfirmaExclusao = document.getElementById('btn_confirma_exclusao');

      if(modalConfirmacao.classList.contains('hidden')) {
        modalConfirmacao.classList.remove('hidden');
        inputConfirmaExclusao.value = '';
        btnConfirmaExclusao.disabled = true;
      }
      else
        modalConfirmacao.classList.add('hidden');
    }
    //* Fim ---

    //* Retira o disabled do botao de exclus√£o do modal de confirma√ß√£o de exclus√£o
    function liberaBotaoExclusao() {
      let inputConfirmaExclusao = document.getElementById('input_confirmation_exclusao');
      let btnConfirmaExclusao = document.getElementById('btn_confirma_exclusao');

      if(inputConfirmaExclusao.value == 'confirmo')
        btnConfirmaExclusao.disabled = false;
      else
        btnConfirmaExclusao.disabled = true;
    }
    //* Fim ---
  </script>


  <script>
    //* Expande e contrai main dimens√£o
    // Toggle functions para controlar abertura/fechamento das camadas
    function toggleDimensao(dimensaoId) {
      var main = document.getElementById('main-dimencao-' + dimensaoId);
      var plus = document.getElementById('plus-dimencao-' + dimensaoId);
      var minus = document.getElementById('minus-dimencao-' + dimensaoId);

      if (!main || !plus || !minus) return;

      if (main.classList.contains('hidden')) {
        main.classList.remove('hidden');
        main.style.display = '';
        plus.classList.add('hidden');
        minus.classList.remove('hidden');
      } else {
        main.classList.add('hidden');
        main.style.display = 'none';
        plus.classList.remove('hidden');
        minus.classList.add('hidden');
      }
    }

    function toggleProcesso(processoId) {
      // processoId √© o id do processo, os elementos s√£o identificados por 'main-processo-<dimensao>-<processo>'
      // Procuramos por qualquer elemento cujo id termine com '-<processoId>' e comece com 'main-processo-'
      var selector = "[id^='main-processo-'][id$='-" + processoId + "']";
      var main = document.querySelector(selector);
      var plus = document.getElementById("plus-processo-" + processoId);
      var minus = document.getElementById("minus-processo-" + processoId);

      if (!main) {
        // fallback: tentar localizar por parte do id quando existem dupla refer√™ncia (dimensao-processo)
        main = document.querySelector("div[id*='main-processo-'][id*='-" + processoId + "']");
      }

      if (!main) return;

      if (plus) plus.classList.add('hidden');
      if (minus) minus.classList.remove('hidden');

      if (main.classList.contains('hidden')) {
        main.classList.remove('hidden');
        main.style.display = '';
        if (plus) plus.classList.add('hidden');
        if (minus) minus.classList.remove('hidden');
      } else {
        main.classList.add('hidden');
        main.style.display = 'none';
        if (plus) plus.classList.remove('hidden');
        if (minus) minus.classList.add('hidden');
      }
    }

    function toggleResultado(dimensaoId, processoId, resultadoId) {
      var mainId = 'main-resultado-' + dimensaoId + '-' + processoId + '-' + resultadoId;
      var plusId = 'plus-resultado-' + dimensaoId + '-' + processoId + '-' + resultadoId;
      var minusId = 'minus-resultado-' + dimensaoId + '-' + processoId + '-' + resultadoId;

      var main = document.getElementById(mainId);
      var plus = document.getElementById(plusId);
      var minus = document.getElementById(minusId);

      if (!main) return;

      if (main.classList.contains('hidden')) {
        main.classList.remove('hidden');
        main.style.display = '';
        if (plus) plus.classList.add('hidden');
        if (minus) minus.classList.remove('hidden');
      } else {
        main.classList.add('hidden');
        main.style.display = 'none';
        if (plus) plus.classList.remove('hidden');
        if (minus) minus.classList.add('hidden');
      }
    }

    //* Expande e contrai main processos
    function show_todos_resultados(form_id,processo){
        if((form_id == (`processo_`+processo+`_icon`)) && (document.getElementById(form_id).classList == "icon-plus abrir_form_resultado_esperado")){
        document.getElementById(`processo_child_`+processo).classList.remove('hidden');
        document.getElementById(form_id).classList.remove('icon-plus');
        document.getElementById(form_id).classList.remove('abrir_form_resultado_esperado');
        document.getElementById(form_id).classList.add('icon-minus');
        document.getElementById(form_id).classList.add('abrir_form_resultado_esperado');
        } else if ((form_id == (`processo_`+processo+`_icon`)) && (document.getElementById(form_id).classList == "icon-minus abrir_form_resultado_esperado")) {
        document.getElementById(`processo_child_`+processo).classList.add('hidden');
        document.getElementById(form_id).classList.remove('icon-minus');
        document.getElementById(form_id).classList.remove('abrir_form_resultado_esperado');
        document.getElementById(form_id).classList.add('icon-plus');
        document.getElementById(form_id).classList.add('abrir_form_resultado_esperado');
        }
    }     

    $(document).ready(function(){

      // Redimensionar todos os textareas com conte√∫do ao carregar a p√°gina
      setTimeout(function() {
        document.querySelectorAll('textarea[name="descricao_avaliador"]').forEach(function(textarea) {
          autoResize(textarea);
        });
      }, 100);
      
      // Segunda tentativa com delay maior para garantir que o conte√∫do foi renderizado
      setTimeout(function() {
        document.querySelectorAll('textarea[name="descricao_avaliador"]').forEach(function(textarea) {
          if (textarea.value && textarea.value.trim() !== '') {
            autoResize(textarea);
          }
        });
      }, 500);

      // Garantir que todos os blocos expans√≠veis comecem escondidos (fallback)
      document.querySelectorAll('.expandable-main').forEach(function(el) {
        try { el.style.display = 'none'; } catch(e) {}
        if (!el.classList.contains('hidden')) el.classList.add('hidden');
      });

      $(".header-select #modelo_aplicado_id").change(function(){
        var classeDaOpcao = this.value;

        var modeloSelecionado = $(this).find('option:selected');
        var opcaoSelecionada = modeloSelecionado.attr('class');

        axios.post("/avaliar/atualizar_opcao", { opcao: opcaoSelecionada , modelo: classeDaOpcao})
        .then(function(response) {
          // L√≥gica para sucesso na resposta
          var redirectUrl = response.data.redirect_url;
          window.location.href = redirectUrl;
          console.log(response.data);
        })
        .catch(function(error) {
          // L√≥gica para erro na resposta
          console.error(error);
        });

      });

      if(document.getElementById("mudancaResultado")) {
        var test = document.getElementById("mudancaResultado");
        if (test.classList.value == "1") {
            var elementos = document.querySelectorAll(".abrir_form_resultado_esperado");
            
            for (var i = 0; i < elementos.length; i++) {
                elementos[i].classList.remove('icon-plus');
                elementos[i].classList.add('icon-caret-right');
            }
        }
      }

      $("#dominio_id").change(function(){
          var inputDominio = document.getElementById("inputDominio");
          inputDominio.value = this.value;
      });

      var maturidadeSelecionadaNivelEscolha = document.getElementById("maturidadeSelecionadaNivelEscolha");

      if(maturidadeSelecionadaNivelEscolha.classList.value == "1" || maturidadeSelecionadaNivelEscolha.classList.value == "3")
      {
          var elementos = document.querySelectorAll('.processoNivelSelecionado');
          elementos.forEach(elemento => {
              elemento.classList.remove('hidden');
          });
      }
      else if(maturidadeSelecionadaNivelEscolha.classList.value == "2")
      {
          var elementos = document.querySelectorAll('.resultadoNivelSelecionado');
          elementos.forEach(elemento => {
              elemento.classList.remove('hidden');
          });
      }
    });

    function resultado_escolha(escolha){
        if(escolha == "2"){
            document.getElementById("nivel_escolha").classList.remove("hidden");
            
        } else if(escolha == "1"){
            document.getElementById("nivel_escolha").classList.add("hidden");
        }
    }

    function show_dimensao(form_id){
        if (form_id == "abrir_form") {
            document.getElementById("form_dimensao_1").classList.remove('hidden');
        } else if (form_id == "cancelar_form") {
            document.getElementById("form_dimensao_1").classList.add('hidden');
        }
    }

    function mostraModelosSalvos() {
        screenFade = document.getElementById('screen-fade');
        div_ModelosSalvos = document.getElementById('modelos-salvos');
        if(screenFade.classList.contains('hidden')) {
            if(div_ModelosSalvos.classList.contains('hidden')) {
                screenFade.classList.remove('hidden');
                div_ModelosSalvos.classList.remove('hidden');
            } 
        }
        else {
            screenFade.classList.add('hidden');
            div_ModelosSalvos.classList.add('hidden');
        }
    }

    // Fun√ß√£o para redimensionar automaticamente o textarea
    function autoResize(textarea) {
        // Reset da altura para calcular corretamente
        textarea.style.height = 'auto';
        
        // Calcular a altura necess√°ria baseada no conte√∫do
        var scrollHeight = textarea.scrollHeight;
        var minHeight = 40; // altura m√≠nima em pixels
        
        // Usar a maior altura entre scrollHeight e minHeight
        var newHeight = Math.max(scrollHeight, minHeight);
        
        // Aplicar a nova altura
        textarea.style.height = newHeight + 'px';
    }

    // Normaliza a √°rvore DOM: move .processo e .resultado para seus containers corretos
    function normalizeNesting() {
      try {
        // Move processos para dentro de main-dimencao-<dimensaoId>
        document.querySelectorAll('div[id^="processo-"]').forEach(function(el) {
          if (!el.classList.contains('processo')) return;
          var parts = el.id.split('-'); // ['processo', '<dimensaoId>', '<processoId>']
          if (parts.length < 3) return;
          var dimensaoId = parts[1];
          var target = document.getElementById('main-dimencao-' + dimensaoId);
          if (target && !el.closest('#main-dimencao-' + dimensaoId)) {
            target.appendChild(el);
            console.log('Moved processo', el.id, 'into', target.id);
          }
        });

        // Move resultados para dentro de main-processo-<dimensao>-<processo>
        document.querySelectorAll('div[id^="resultado-"]').forEach(function(el) {
          if (!el.classList.contains('resultado')) return;
          var parts = el.id.split('-'); // ['resultado', '<dimensaoId>', '<processoId>', '<resultadoId>']
          if (parts.length < 4) return;
          var dimensaoId = parts[1];
          var processoId = parts[2];
          var target = document.getElementById('main-processo-' + dimensaoId + '-' + processoId);
          if (target && !el.closest('#main-processo-' + dimensaoId + '-' + processoId)) {
            target.appendChild(el);
            console.log('Moved resultado', el.id, 'into', target.id);
          }
        });
      } catch(e) {
        console.error('normalizeNesting error', e);
      }
    }

    // Executa ap√≥s renderiza√ß√£o completa
    setTimeout(function() { normalizeNesting(); }, 150);

    // Corrigir elementos mal-nested: esconder processos/resultado que n√£o est√£o dentro do seu pai esperado
    setTimeout(function() {
      try {
        document.querySelectorAll('.processo').forEach(function(proc) {
          if (!proc.closest("[id^='main-dimencao-']") && !proc.closest("[id^='main-processo-']")) {
            proc.style.display = 'none';
          }
        });

        document.querySelectorAll('.resultado').forEach(function(res) {
          if (!res.closest("[id^='main-processo-']") && !res.closest("[id^='main-resultado-']")) {
            res.style.display = 'none';
          }
        });
      } catch(e) {
        // n√£o bloquear se houver erro
        console.error('cleanup nesting error', e);
      }
    }, 100);
</script>
